# お問い合わせを Google スプレッドシートに保存する手順

**コマンドラインでの Google ログインは不要です。** ブラウザで Google にログインした状態で、以下の手順を実施してください。

---

## 1. Google スプレッドシートを作成

1. [Google スプレッドシート](https://sheets.google.com) を開く
2. 新しいスプレッドシートを作成（「空白」でOK）
3. スプレッドシートの名前を「OpenClaw お問い合わせ」など分かりやすい名前に変更

---

## 2. Apps Script を追加

1. スプレッドシートのメニューで **拡張機能** → **Apps Script** をクリック
2. 新しいタブで Apps Script エディタが開く
3. デフォルトの `function myFunction() {}` を **すべて削除**
4. プロジェクト内の `scripts/ContactToSheet.gs` の内容を **すべてコピー** して貼り付け
5. 先頭付近の **`SITE_URL`** を、あなたのサイトのURLに変更する  
   - 例: `const SITE_URL = 'https://your-domain.com';`  
   - ローカル確認の場合は `http://localhost:4000` でも可
6. **保存**（Ctrl+S / Cmd+S）

---

## 3. Web アプリとしてデプロイ

1. エディタ右上の **「デプロイ」** → **「新しいデプロイ」** をクリック
2. 種類で **「ウェブアプリ」** を選択
3. 設定:
   - **説明**: 「お問い合わせフォーム」など任意
   - **次のユーザーとして実行**: **自分**
   - **アクセスできるユーザー**: **全員**（重要）
4. **「デプロイ」** をクリック
5. **「承認が必要です」** と出たら **「承認」** をクリック
6. 表示される **「ウェブアプリの URL」** をコピー（`https://script.google.com/macros/s/...` の形式）

※ 初回は「アプリにアクセスする権限」を求める画面が出ます。**自分の Google アカウント** を選び「許可」してください。

---

## 4. サイトに URL を設定

### 方法 A: 環境変数（本番・ビルド時）

プロジェクト直下に `.env` を作成（または既存の `.env` に追記）:

```env
PUBLIC_CONTACT_FORM_ACTION=https://script.google.com/macros/s/あなたのID/exec
```

`npm run build` や `pnpm build` でビルドすると、フォームの送信先がこの URL になります。

### 方法 B: コードに直接書く（開発時）

`src/pages/contact.astro` のフロントマatter内で、`formAction` を書き換える:

```ts
const formAction = "https://script.google.com/macros/s/あなたのID/exec";
```

---

## 5. 動作確認

1. サイトのお問い合わせページを開く
2. 必要項目を入力して「お問い合わせする」をクリック
3. 送信後、`/contact/thanks` にリダイレクトされれば成功
4. Google スプレッドシートを開き、1行目にヘッダー、2行目以降に送信内容が追加されていることを確認

---

## トラブルシューティング

- **送信後に「リダイレクトしています」のまま止まる**  
  - `ContactToSheet.gs` の `SITE_URL` が正しいか確認（末尾の `/` は不要）
- **スプレッドシートに追記されない**  
  - デプロイ時の「アクセスできるユーザー」が **「全員」** になっているか確認
  - 再度デプロイして新しい URL を発行し、`formAction` を更新
- **403 や CORS エラー**  
  - フォームは **通常の POST 送信**（画面遷移）のため、CORS は発生しません。送信先 URL が `.../exec` で終わっているか確認してください。
